name: Notify Main Repo

on:
  workflow_run:
    workflows: ["Build Registry"]
    types: [completed]
    branches: [main]

jobs:
  notify:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    
    steps:
      - name: Trigger update no AetherCore-host
        run: |
          response=$(curl -s -w "\n%{http_code}" -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.MAIN_REPO_TOKEN }}" \
            https://api.github.com/repos/AsafViana/AetherCore-host/dispatches \
            -d '{"event_type":"patches-updated","client_payload":{"repo":"aethercore-patches","ref":"${{ github.sha }}"}}')
          
          http_code=$(echo "$response" | tail -n1)
          
          if [ "$http_code" -eq 204 ]; then
            echo "âœ… Webhook enviado com sucesso para AetherCore-host"
          else
            echo "âŒ Erro ao enviar webhook: HTTP $http_code"
            exit 1
          fi
      
      - name: Summary
        if: success()
        run: |
          echo "### ðŸ“¡ Webhook Enviado" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Destino:** AsafViana/AetherCore-host" >> $GITHUB_STEP_SUMMARY
          echo "**Event:** patches-updated" >> $GITHUB_STEP_SUMMARY
          echo "**Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
